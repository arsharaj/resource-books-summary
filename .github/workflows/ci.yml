name : Continuous Integration

on :
  push :
    branches :
      - main

  pull_request :
    branches :
      - main

jobs :
  build :
    runs-on : ubuntu-latest

    steps :
      - name : Checkout code
        uses : actions/checkout@v3

      - name : Set up nodejs
        uses : actions/setup-node@v3
        with :
          node-version: 20
          cache: 'npm'

      - name : Install dependencies
        run  : |
          echo "start : installing dependencies"
          npm ci
          echo "end : installing dependencies"

      - name : Astro type check
        run  : |
          echo "start : running astro type check"
          npm run astro check
          echo "end : running astro type check"

      - name : Deploy
        if   : github.ref == 'refs/heads/main'
        run  : |
          echo "start : deploying project"
          npm run deploy
          echo "end : deploying project"